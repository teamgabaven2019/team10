window.ParentIDE=null!=window.opener?window.opener:window.parent,window.Consts={iframeUrlPrefix:window.previewUrl,frameSize:55,deviceList:{iphone8:{platform:"iOS",name:"iPhone 8",width:750,height:1334,viewportWidth:375},iphone8plus:{platform:"iOS",name:"iPhone 8 Plus",width:1242,height:2208,viewportWidth:414},iphonex:{platform:"iOS",name:"iPhone X",width:1125,height:2436,viewportWidth:375},ipadpro10:{platform:"iOS",name:"iPad Pro 10.5in",width:1668,height:2224,viewportWidth:834},ipadpro12:{platform:"iOS",name:"iPad Pro 12.9in",width:2048,height:2732,viewportWidth:1024},pixel2:{platform:"Android",name:"Pixel 2",width:1080,height:1920,viewportWidth:360},pixel2xl:{platform:"Android",name:"Pixel 2 XL",width:1440,height:2880,viewportWidth:480},galaxys8:{platform:"Android",name:"Galaxy S8",width:1440,height:2960,viewportWidth:480},xperiaxz1:{platform:"Android",name:"Xperia XZ1",width:1080,height:1920,viewportWidth:360}},checkIcon:"ui-icon-check",isEditor:ParentIDE.config&&ParentIDE.config.isEditor||!1,projectId:window.projectId,staticPreviewUrl:ParentIDE.config.staticPreviewUrl},window.i18n={textMap:{ja:{USE_DEBUGGER:'正確に表示するには、<a href="https://docs.monaca.io/ja/products_guide/debugger/installation/" target="_blank">Monaca Debugger</a> を利用してください。',VERTICAL:"縦向き",HORIZONTAL:"横向き"},en:{USE_DEBUGGER:'To see the actual design, use <a href="https://docs.monaca.io/en/products_guide/debugger/installation/" target="_blank">Monaca Debugger</a>.',VERTICAL:"Vertical",HORIZONTAL:"Horizontal"}},text:function(textId){return i18n.textMap["ja"==LANG?"ja":"en"][textId]},applyText:function(){$(".i18n-text").each(function(index,element){$element=$(element);var textId=$element.data("i18n");$element.html(i18n.text(textId))})}},window.Device={isVertical:!0,aspect:"iphone8",showMsgDebugger:!0,SETTING_ATTR_LIST:["isVertical","aspect","showMsgDebugger"],setDefaultAspect:function(){void 0===Consts.deviceList[this.aspect]&&(this.aspect="iphone8")},getAspect:function(){return this.aspect},setAspect:function(aspect){this.aspect=aspect,this.saveSettings(),this.onAspectChange()},onAspectChange:function(){window.subscribeData&&window.subscribeData.PubSub.publish(window.subscribeData.Constant.EVENT.PREVIEWER_VIEW_DEVICE_CHANGED,{id:this.aspect,device:window.Consts.deviceList[this.aspect],componentId:window.previewerId})},getIsVertical:function(){return this.isVertical},setIsVertical:function(isVertical){this.isVertical=isVertical,this.saveSettings()},getRawWidth:function(){return this.setDefaultAspect(),Consts.deviceList[this.aspect].width},getRawHeight:function(){return this.setDefaultAspect(),Consts.deviceList[this.aspect].height},getRawViewportWidth:function(){return this.setDefaultAspect(),Consts.deviceList[this.aspect].viewportWidth},getRawViewportHeight:function(){return this.setDefaultAspect(),Math.round(this.getRawHeight()*(this.getRawViewportWidth()/this.getRawWidth()))},getViewportWidth:function(){return this.isVertical?this.getRawViewportWidth():this.getRawViewportHeight()},getViewportHeight:function(){return this.isVertical?this.getRawViewportHeight():this.getRawViewportWidth()},getWidth:function(){return this.isVertical?this.getRawWidth():this.getRawHeight()},getHeight:function(){return this.isVertical?this.getRawHeight():this.getRawWidth()},reload:function(){window.isTerminalFeatureEnabled()||FileCombo.getUrl()!==Consts.staticPreviewUrl?$.ajax({url:FileCombo.getUrl(),xhrFields:{withCredentials:!0},success:function(){$E.iframe.attr("src",FileCombo.getUrl())},error:function(){$E.iframe.attr("src",Consts.staticPreviewUrl),window.subscribeData.PubSub.publish(window.subscribeData.Constant.EVENT.PREVIEWER_VIEW_URL_FAILED)}}):$E.iframe.attr("src",Consts.staticPreviewUrl)},getStorageKey:function(){return`${Consts.projectId}_${window.previewerId}_previewer`},saveSettings:function(){var self=this,data={};self.SETTING_ATTR_LIST.forEach(function(attr){data[attr]=self[attr]}),localStorage.setItem(self.getStorageKey(),JSON.stringify(data))},getSettingParamsStr:function(){var data=localStorage.getItem(this.getStorageKey()),str="";return null!=data&&(data=JSON.parse(data),str="?"+this.getOrientationParamStr(data.isVertical)+this.getModelParamsStr(data.aspect)),str},getOrientationParamStr:function(isVertical){return 1==isVertical?"orientation=portrait":"orientation=landscape"},getModelParamsStr:function(model){var ret="";for(var key in Consts.deviceList[model])ret+="&"+key+"="+encodeURIComponent(Consts.deviceList[model][key]);return ret},restoreSettings:function(){var self=this,data=localStorage.getItem(self.getStorageKey());null!=data&&(data=JSON.parse(data),self.SETTING_ATTR_LIST.forEach(function(attr){void 0!==data[attr]&&(self[attr]=data[attr])})),self.showMsgDebugger?$E.extraInfo.show():$E.extraInfo.hide(),this.onAspectChange()}},window.Layout={onResize:function(){var meshWidth=$E.window.innerWidth(),meshHeight=$E.window.innerHeight()-$E.nav.innerHeight()-4,finalWidth=Math.max(150,meshWidth),finalHeight=Math.max(150,meshHeight),viewportWidth=Device.getViewportWidth(),viewportHeight=Device.getViewportHeight(),scale=Math.min(finalWidth/viewportWidth,finalHeight/viewportHeight);finalWidth=Math.round(viewportWidth*scale),finalHeight=Math.round(viewportHeight*scale),$E.iframe.width(viewportWidth),$E.iframe.height(viewportHeight),$E.iframe.css("transform","scale("+scale+")"),$E.previewBox.width(finalWidth),$E.previewBox.height(finalHeight),window.setTimeout(function(){$E.extraInfo.width($E.window.innerWidth()-16)},100)}},window.FileCombo={items:{},updateOptions:function(){Device.reload()},getUrl:function(){return Consts.iframeUrlPrefix+Device.getSettingParamsStr()},updateUrl:function(url){url&&url!==Consts.iframeUrlPrefix&&(Consts.iframeUrlPrefix=url)}},window.Menu={init:function(){this._initDeviceDropdown(),this._initButtons()},_initDeviceDropdown:function(){const $select=$("#device-dropdown"),deviceKeys=Object.keys(window.Consts.deviceList);let groupedDevices={};deviceKeys.forEach(key=>{window.Consts.deviceList[key]}),deviceKeys.forEach(key=>{const device=window.Consts.deviceList[key],deviceDisplayName=`${device.name} (${device.width}x${device.height})`,optHtml=`<option value="${key}" ${window.Device.getAspect()===key?"selected":""}>${deviceDisplayName}</option>`;groupedDevices[device.platform]||(groupedDevices[device.platform]=[]),groupedDevices[device.platform].push(optHtml)}),Object.keys(groupedDevices).forEach(key=>{const devices=groupedDevices[key];$select.append(`<optgroup label="${key}">${devices.join("")}</optgroup>`)}),$select.on("change",ev=>{window.Device.setAspect(ev.currentTarget.value),window.Device.reload(),window.Layout.onResize()})},_initButtons:function(){$portraitButton=$("#orientation-button-portait"),$landscapeButton=$("#orientation-button-landscape"),window.Device.isVertical?$portraitButton.addClass("disabled"):$landscapeButton.addClass("disabled"),$portraitButton.on("click",()=>(window.Device.setIsVertical(!0),window.Device.reload(),window.Layout.onResize(),$portraitButton.addClass("disabled"),$landscapeButton.removeClass("disabled"),!1)),$landscapeButton.on("click",()=>(window.Device.setIsVertical(!1),window.Device.reload(),window.Layout.onResize(),$landscapeButton.addClass("disabled"),$portraitButton.removeClass("disabled"),!1)),$("#reload-button").on("click",()=>(window.Device.reload(),!1)),$("#attach-button").on("click",()=>(window.close(),!1)),$("#detach-button").on("click",()=>(window.parentPreviewer.onDetachBtn(),!1))}},window.isTerminalFeatureEnabled=function(){if(!ParentIDE.config.client.service.terminal)return!1;try{if(!ParentIDE.parent.location.search)return!0;const previewer=new URLSearchParams(ParentIDE.location.search).get("terminal");return!previewer||"0"!==previewer&&"false"!==previewer}catch(err){return!0}},$(function(){window.componentId=location.search.match(/id=(\d*)/)[1],window.previewerId="mn-gl-"+componentId,window.parentPreviewer=ParentIDE.angular.element(ParentIDE.document.querySelector(`#${previewerId} .previewer-view`)).isolateScope(),window.subscribeData=ParentIDE.angular.element(ParentIDE.document.querySelector(".ide-wrapper")).scope().fetchForSubscribe(),window.onbeforeunload=function(event){window.subscribeData.PubSub.publish(window.subscribeData.Constant.EVENT.TOGGLE_PREVIEWER_VIEW,{open:!0,componentState:{id:componentId}})},window.$E={window:$(window),nav:$("nav"),previewWrap:$("#PreviewWrap"),previewBox:$("#PreviewBox"),extraInfo:$("#ExtraInfo"),iframe:$("#PreviewBox iframe")},i18n.applyText(),Device.restoreSettings(),Layout.onResize(),Menu.init(),FileCombo.updateOptions(),$E.window.resize(function(){Layout.onResize()}),$E.extraInfo.find(".close-btn").click(function(){return $E.extraInfo.fadeOut(200),Device.showMsgDebugger=!1,Device.saveSettings(),!1}),window.Consts.isEditor||($("#attach-button").hide(),$("#detach-button").hide());var global=window;window.Consts.isEditor&&window.subscribeData.PubSub.subscribe(window.subscribeData.Constant.EVENT.PREVIEWER_VIEW_URL_CHANGED,function(data){global.FileCombo.updateUrl(data.url)}),window.isTerminalFeatureEnabled()||window.subscribeData.PubSub.subscribe(window.subscribeData.Constant.EVENT.PREVIEWER_VIEW_URL_REFRESH,function(data){global.FileCombo.updateOptions()})});